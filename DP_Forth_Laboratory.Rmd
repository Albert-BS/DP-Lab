---
title: "Untitled"
author: "Albert Bertran"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
install.packages("LaplacesDemon")
```


```{r}
adult_train <- read.csv("D:/adult_train.csv")
library(LaplacesDemon)
```

```{r}
adult <- adult_train[c('age')]
```


```{r, warning=FALSE}
laplace_mechanism1 <- function(x, epsilon) {
  sensitivity <- 125
  scale <- sensitivity / epsilon
  noise <- rlaplace(n = 1, loc = 0, scale = scale)
  return(x + noise)
}

dp_naive <- function(adult, epsilon) {
  n <- nrow(adult)
  d <- ncol(adult)
  dp_data <- matrix(0, nrow = n, ncol = d)
  for (i in 1:n) {
    dp_data[i] <- laplace_mechanism1(adult[i,], epsilon)
  }
  return(as.data.frame(dp_data))
}

epsilon <- 0.01
errors = c()
meanAfterDp = c()
for (i in 1:10) {
  histogramE = c()
  histogramM = c()
  for (j in 1:25) {
    dp_data <- dp_naive(adult, epsilon)
    mdp <- mean(dp_data$V1)
    morig <- mean(adult$age)
    histogramE[j] <- abs(mdp - morig)
    histogramM[j] <- mdp
  }
  e <- mean(histogramE)
  errors[i] <- e
  m <- mean(histogramM)
  meanAfterDp[i] <- m
  epsilon <- epsilon + 0.299
}
errors
```

